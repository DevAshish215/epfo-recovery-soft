# Deploy EPFO Recovery Soft on Render (Blueprint)

Use the `render.yaml` Blueprint to deploy **backend** and **frontend** on Render in one go.

---

## Prerequisites

- **GitHub** account, repo with your code pushed
- **MongoDB Atlas** free cluster + connection string ([setup](DEPLOYMENT_GUIDE.md#-step-1-set-up-mongodb-atlas-database))
- **Render** account ([render.com](https://render.com))

---

## 1. Push to GitHub

```bash
git init
git add .
git commit -m "EPFO Recovery Soft – Render deployment"
git remote add origin https://github.com/YOUR_USERNAME/epfo-recovery-soft.git
git branch -M main
git push -u origin main
```

Use a **public** repo if you want Render’s free tier.

---

## 2. Deploy via Blueprint

1. Go to [Render Dashboard](https://dashboard.render.com) → **New +** → **Blueprint**.
2. Connect **GitHub** and select the `epfo-recovery-soft` repo.
3. Render will detect `render.yaml`. Click **Apply**.

You’ll be prompted for env vars marked `sync: false`. Have these ready:

| Variable | Service | Example / notes |
|----------|---------|------------------|
| `MONGO_URI` | Backend | `mongodb+srv://user:pass@cluster.mongodb.net/epfo_recovery?retryWrites=true&w=majority` |
| `GROQ_API_KEY` | Backend | Optional. From [Groq Console](https://console.groq.com) if you use Groq. |
| `FRONTEND_URL` | Backend | Frontend URL, e.g. `https://epfo-recovery-frontend.onrender.com` |
| `VITE_API_URL` | Frontend | Backend API URL, e.g. `https://epfo-recovery-backend.onrender.com/api` |

**First-time deploy:** Use placeholders for `FRONTEND_URL` and `VITE_API_URL` if you don’t have the URLs yet. Update them after both services exist.

---

## 3. Set env vars (and fix order)

1. **Backend** → **Environment**:
   - `MONGO_URI`: your Atlas connection string (replace `<password>`, set DB name).
   - `JWT_SECRET`: auto-generated by Blueprint; or set your own (min 32 chars).
   - `GROQ_API_KEY`: optional.
   - `FRONTEND_URL`: `https://<your-frontend>.onrender.com` (no trailing slash).

2. **Frontend** → **Environment**:
   - `VITE_API_URL`: `https://<your-backend>.onrender.com/api`.

3. **Redeploy** backend after setting `FRONTEND_URL`, and frontend after setting `VITE_API_URL`, so CORS and API calls work.

---

## 4. Keep backend awake (free tier)

Free web services sleep after ~15 min idle. Use [UptimeRobot](https://uptimerobot.com) (free):

1. **Add monitor** → **HTTP(s)**.
2. **URL**: `https://<your-backend>.onrender.com/api/health`
3. **Interval**: 5 minutes.

---

## 5. Verify

- **Backend:**  
  `https://<your-backend>.onrender.com/api/health`  
  → JSON with `"status": "ok"`, `"database": "connected"`.
- **Frontend:**  
  `https://<your-frontend>.onrender.com`  
  → App loads, login and main flows work.

---

## Troubleshooting

| Issue | Check |
|-------|--------|
| MongoDB connection fails | Atlas IP allowlist includes `0.0.0.0/0`; correct user/pass in `MONGO_URI`. |
| CORS errors | `FRONTEND_URL` matches the frontend URL exactly (no trailing slash); backend redeployed. |
| Frontend can’t reach API | `VITE_API_URL` is `https://...onrender.com/api`; frontend redeployed after changing it. |
| Backend always sleeping | UptimeRobot pinging `/api/health` every 5 min. |

---

## Reference

- Full guide: [DEPLOYMENT_GUIDE.md](DEPLOYMENT_GUIDE.md)
- Blueprint: [render.yaml](render.yaml)
